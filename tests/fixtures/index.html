<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TraceLog E2E Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container" style="height: 1200px;">
        <h1 data-testid="title">TraceLog E2E Test Page</h1>
        <button
            id="test-button"
            data-testid="test-button"
            data-tl-name="test_button"
            data-tl-value="test_value">
            Test Button
        </button>

        <button
            id="custom-event-btn"
            data-testid="custom-event-btn">
            Send Custom Event
        </button>

        <button
            id="empty-name-btn"
            data-testid="empty-name-btn"
            data-tl-name="">
            Empty Name
        </button>

        <button
            id="trigger-js-error-btn"
            data-testid="trigger-js-error-btn">
            Trigger JS Error
        </button>

        <button
            id="trigger-promise-rejection-btn"
            data-testid="trigger-promise-rejection-btn">
            Trigger Promise Rejection
        </button>

        <button
            id="trigger-network-error-btn"
            data-testid="trigger-network-error-btn">
            Trigger Network Error
        </button>

        <button
            id="trigger-xhr-error-btn"
            data-testid="trigger-xhr-error-btn">
            Trigger XHR Error
        </button>
    </div>

    <script type="module">
        import { TraceLog } from './tracelog.js';
        
        async function initializeTraceLog() {
            try {
                await TraceLog.init({ id: 'test' });

                console.log('TraceLog initialized successfully');
                
                document.getElementById('custom-event-btn')?.addEventListener('click', () => {
                    try {
                        TraceLog.event('playwright_event', { foo: 'bar' });
                        console.log('Custom event sent successfully');
                    } catch (error) {
                        console.error('Error sending custom event:', error);
                    }
                });

                document.getElementById('trigger-js-error-btn')?.addEventListener('click', () => {
                    // @ts-ignore - Intentionally accessing undefined property
                    window.nonExistentObject.someProperty;
                });

                document.getElementById('trigger-promise-rejection-btn')?.addEventListener('click', () => {
                    Promise.reject(new Error('Test promise rejection from button'));
                });

                document.getElementById('trigger-network-error-btn')?.addEventListener('click', () => {
                    fetch('/button-triggered-error-endpoint').catch(() => {
                        console.log('Network error triggered');
                    });
                });

                document.getElementById('trigger-xhr-error-btn')?.addEventListener('click', () => {
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', '/button-triggered-xhr-error');
                    xhr.send();
                });
            } catch (error) {
                console.error('Error initializing TraceLog:', error);
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeTraceLog);
        } else {
            initializeTraceLog();
        }
    </script>
</body>
</html> 
