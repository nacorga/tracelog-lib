---
globs: tests/e2e/**
alwaysApply: false
---

# E2E Testing Guide for TraceLog SDK

Concise Playwright rules for browser E2E tests.

## ğŸ¯ Objectives

* Validate SDK on Chromium, Firefox, WebKit, and mobile.
* Cover core user flows, integration, and error handling.

## ğŸ—ï¸ Structure

```
tests/e2e/            # test categories
fixtures/             # html pages + built SDK
utils/                # helpers (export TestUtils)
```

Flow: Load â†’ Init â†’ Interact â†’ Capture â†’ Assert â†’ Cleanup

## ğŸ› ï¸ Conventions

* File/folder: kebab-case. Constants: UPPER\_SNAKE\_CASE.
* Test titles: `[Category] outcome-focused`.
* Use TestUtils as single import; only functions, no classes.
* Config: `TEST_CONFIGS.DEFAULT` (automatically enables `qaMode=true` and uses local config).
* Centralized logging via `TestUtils.createConsoleMonitor(page)`.

## ğŸ”’ Rules

**Must**

* Reset storage each test.
* Use `TestUtils.waitFor*` instead of timeouts.
* Keep tests hermetic (no external services).

**Never**

* Hardcoded sleeps, missing awaits, brittle CSS selectors.
* Use production endpoints/keys.
* Commit flaky tests.

## ğŸ§ª Reliability

* Flake budget = 0. Quarantine failing tests with `test.fixme`.
* Locators: prefer `getByRole` / `getByTestId`.
* Attach traces/screenshots on failure.

## ğŸš€ Commands

```bash
npm run build:browser
npm run serve:test
npm run test:e2e
npx playwright test --project=chromium --debug
```

## ğŸ“ˆ Success Criteria

* 100% passing across all browsers.
* No console errors, leaks, or leftover state.
* Realistic interactions validated.

## âœ… Quality Gates

* All tests + lint + build must pass before merge.
* Playwright config: projects for 3 browsers + mobile, trace/screenshots on failure, webServer serving `fixtures/`.
* PRs must link HTML report and include trace artifacts on failure.
